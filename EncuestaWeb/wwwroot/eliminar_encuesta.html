<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Eliminar Encuesta</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h2>🗑️ Eliminar Encuesta</h2>
        <label for="selectEncuesta">Selecciona una encuesta para eliminar:</label>
        <select id="selectEncuesta">
            <option disabled selected>Selecciona una encuesta</option>
        </select>
        <button id="btnEliminar">Eliminar Encuesta</button>
    </div>

    <script>
    const BASE_URL = `${location.protocol}//${location.hostname}:44341`;
    const token = sessionStorage.getItem("token");

    const select = document.getElementById("selectEncuesta");
    const btn = document.getElementById("btnEliminar");

    async function cargarEncuestas() {
      try {
        const res = await fetch(`${BASE_URL}/api/encuestas`, {
          headers: { Authorization: "Bearer " + token }
        });
        const data = await res.json();

        data.lstEncusta.forEach(e => {
          const opt = document.createElement("option");
          opt.value = e.id;
          opt.textContent = e.titulo;
          select.appendChild(opt);
        });
      } catch (err) {
        alert("Error al cargar encuestas");
      }
    }

    btn.addEventListener("click", async () => {
      const id = select.value;
      if (!id || isNaN(id)) {
        alert("Por favor selecciona una encuesta");
        return;
      }

      const confirmacion = confirm("¿Estás seguro de eliminar esta encuesta?");
      if (!confirmacion) return;

      try {
        const res = await fetch(`${BASE_URL}/api/encuestas/${id}`, {
          method: "DELETE",
          headers: {
            Authorization: "Bearer " + token
          }
        });
        if (res.ok) {
          alert("✅ Encuesta eliminada");
          location.reload();
        } else {
          const msg = await res.text();
          alert("❌ " + msg);
        }
      } catch (err) {
        alert("❌ Error al eliminar: " + err.message);
      }
    });

    cargarEncuestas();
    </script>
</body>
</html>
